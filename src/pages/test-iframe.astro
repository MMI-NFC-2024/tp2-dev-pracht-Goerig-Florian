---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <h1>Test IFRAME — Espèces de pingouins</h1>

  <!-- Menu : chaque lien a target="speciesFrame" -->
  <p style="display:flex; gap:.5rem; flex-wrap:wrap;">
    <a href="/species/Adelie" target="speciesFrame">Adelie</a>
    <a href="/species/Gentoo" target="speciesFrame">Gentoo</a>
    <a href="/species/Chinstrap" target="speciesFrame">Chinstrap</a>
  </p>

  <div style="border:1px solid #eee; border-radius:12px; overflow:hidden;">
    <!-- IFRAME nommée, charge Adelie par défaut -->
    <iframe
      name="speciesFrame"
      src="/species/Adelie"
      title="Graphique d'espèce"
      style="width:100%; height:600px; border:0; display:block;"
      onload="resizeIframe(this)"></iframe>
  </div>

  <script>
    // Redimensionne l’iframe à la hauteur de son contenu (même site = même origine ⇒ OK)
    function resizeIframe(iframe) {
      try {
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        if (!doc) return;

        // Mesure la hauteur du contenu
        const html = doc.documentElement;
        const body = doc.body;
        const height = Math.max(
          body?.scrollHeight || 0,
          html?.scrollHeight || 0,
          body?.offsetHeight || 0,
          html?.offsetHeight || 0,
          body?.clientHeight || 0,
          html?.clientHeight || 0
        );

        // Applique la hauteur avec une marge
        iframe.style.height = height + 16 + "px";
      } catch (e) {
        // Si cross-origin (pas le cas ici), on ne peut pas mesurer
        console.warn("Impossible de redimensionner l’iframe :", e);
      }
    }
  </script>
</Layout>
